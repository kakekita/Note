<!doctype html>
<html lang="ja">
  <head>
    <style>
      #mainCVS {
        background-color: mintcream;
        display: block;
      }
      
      #wrapper{
        width: 100%;
        height: 100%;
        position: relative;
      }
    </style>
  </head>
  <body>
    <input type="file" id="file_Select">
    <div id="wrapper">
      
    </div>
    <script>
      var wr = document.getElementById("wrapper");
      var file_sel = document.getElementById("file_Select");
      var data = null;
      
      document.body.addEventListener('keydown', function(e) {
        if(e.ctrlKey) {
          if(e.shiftKey) {
            if(e.code === "KeyS"){
              save();
            }
          }
        }
      },false);
      
      file_sel.addEventListener("change", load);
      
      function save() {
        let write_json=JSON.stringify(data);
        let blob=new Blob([write_json], {type: 'application/json'});
        let a=document.createElement("a");
        a.href=URL.createObjectURL(blob);
        var name = prompt("ファイル名","");
        a.download = name+'.json';
        a.click();
        URL.revokeObjectURL(a.href);
      }
      
      function load() {
        if(!(file_sel.value)) return; // ファイルが選択されない場合
        var file_list=file_sel.files;
        if(!file_list) return; // ファイルリストが選択されない場合
        var file=file_list[0];
        if(!file) return; // ファイルが無い場合
        
        var file_reader=new FileReader();
        file_reader.readAsText(file);
        file_reader.onload=function(){
          data = JSON.parse(file_reader.result);
          //var write_json=JSON.stringify(data);
          //localStorage.setItem('id_back', write_json);
          //location.reload();
          drawTexts();
        };
      }
        
      
      function drawTexts() {
        for(var d in data) {
          var text_1 = data[d]["text"];
          var x_1 = data[d]["x"];
          var y_1 = data[d]["y"];
          var id_1 = data[d]["id"];
          var ele = document.createElement("textarea");
          ele.style.position = "absolute";
          ele.id = id_1;
          ele.value = text_1;
          ele.style.left = String(x_1)+"px";
          ele.style.top = String(y_1)+"px";
          
          wr.append(ele);
          alert();
        }
      }
    </script>
  </body>
</html>
